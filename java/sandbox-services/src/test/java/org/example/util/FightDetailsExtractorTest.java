package org.example.util;

import static org.junit.jupiter.api.Assertions.assertEquals;

import java.io.IOException;
import java.nio.charset.StandardCharsets;
import java.util.List;
import java.util.Objects;
import org.example.entity.Bout;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.junit.jupiter.api.Test;

class FightDetailsExtractorTest {

  @Test
  void testExtract() throws IOException {
    String html =
        new String(
            Objects.requireNonNull(
                    getClass()
                        .getClassLoader()
                        .getResourceAsStream("data/314900-ryan-dobinson.html"))
                .readAllBytes(),
            StandardCharsets.UTF_8);
    Document doc = Jsoup.parse(html);
    List<Bout> bout = FightDetailsExtractor.extract(doc);
    String expected =
        "[Bout{id='b1082519', status='unknown', sport='mma', division='amateur', boutId='1082519', method='null', opponentId='377781-jack-bangs', boutPageId='1082519-ecc-5-ryan-the-ginger-ninja-dobinson-vs-jack-bangs', fightShortDescription='Awaiting Results', eventPageId='137279-ecc-5', eventName='ECC 5', fighterRecordBeforeFight='7-4', opponentRecordBeforeFight='5-4', fightYear='2025', fightDay='Dec 20', details={Event:=ECC 5, Title Bout:=ECC Featherweight Championship, Status Before Fight:=Dobinson Champion, Billing:=Main Event, Duration:=5 x 3 Minute Rounds, Weight:=Featherweight · 145 lbs (65.8 kg)}}, Bout{id='b1083200', status='win', sport='mma', division='amateur', boutId='1083200', method='DEC', opponentId='467881-bilal-omari', boutPageId='1083200-king-of-the-octagon-2-ryan-the-ginger-ninja-dobinson-vs-bilal-omari', fightShortDescription='Decision · Unanimous', eventPageId='136429-king-of-the-octagon-2', eventName='King of the Octagon 2', fighterRecordBeforeFight='null', opponentRecordBeforeFight='null', fightYear='2025', fightDay='Nov 29', details={Event:=King of the Octagon 2, warning=Bout has been flagged by Tapology for potential issues with legitimacy., Reason:=Promotion - Pattern of Record-Padding/Mismatches, Record:=Bout deemed ineligible for fighter win-loss record., Title Bout:=KOTO Featherweight Championship, Status Before Fight:=Unknown / Possibly Vacant, Billing:=Co-Main Event, Duration:=5 x 3 Minute Rounds, Weight:=Featherweight · 145 lbs (65.8 kg)}}, Bout{id='b1042151', status='loss', sport='mma', division='amateur', boutId='1042151', method='DEC', opponentId='236225-harry-edwards', boutPageId='1042151-british-fighting-championship-8-ryan-the-ginger-ninja-dobinson-vs-harry-endgame-edwards', fightShortDescription='Decision · Unanimous', eventPageId='133115-british-fighting-championship-8-bfc-8', eventName='BFC 8', fighterRecordBeforeFight='7-3', opponentRecordBeforeFight='7-4', fightYear='2025', fightDay='Oct 18', details={Event:=BFC 8, Title Bout:=BFC Featherweight Championship, Status Before Fight:=Dobinson Interim Champion, Billing:=Co-Main Event, Duration:=5 x 3 Minute Rounds, Weight:=Featherweight · 145 lbs (65.8 kg)}}, Bout{id='b1026000', status='cancelled', sport='mma', division='amateur', boutId='1026000', method='null', opponentId='180679-aftab-javed', boutPageId='1026000-ecc-4-aftab-javed-vs-ryan-the-ginger-ninja-dobinson', fightShortDescription='Cancelled Bout', eventPageId='130269-ecc-4', eventName='ECC 4', fighterRecordBeforeFight='null', opponentRecordBeforeFight='null', fightYear='2025', fightDay='Jul 26', details={Event:=ECC 4, Weight:=Featherweight · 145 lbs (65.8 kg)}}, Bout{id='b1022736', status='win', sport='mma', division='amateur', boutId='1022736', method='TKO', opponentId='180679-aftab-javed', boutPageId='1022736-ecc-4-aftab-javed-vs-ryan-the-ginger-ninja-dobinson', fightShortDescription='Punches · 2:59 · R3', eventPageId='130269-ecc-4', eventName='ECC 4', fighterRecordBeforeFight='6-3', opponentRecordBeforeFight='8-8', fightYear='2025', fightDay='Jul 26', details={Event:=ECC 4, Title Bout:=ECC Featherweight Championship, Status Before Fight:=Dobinson Challenger, Billing:=Main Card, Duration:=5 x 3 Minute Rounds, Weight:=Featherweight · 145 lbs (65.8 kg), Referee:=Stefan Joachim}}, Bout{id='b1031400', status='win', sport='mma', division='amateur', boutId='1031400', method='DEC', opponentId='444966-george-plevin', boutPageId='1031400-king-of-the-octagon-1-ryan-the-ginger-ninja-dobinson-vs-george-plevin', fightShortDescription='Decision · Unanimous', eventPageId='132065-king-of-the-octagon-1', eventName='King of the Octagon 1', fighterRecordBeforeFight='5-3', opponentRecordBeforeFight='3-2', fightYear='2025', fightDay='Jul 5', details={Event:=King of the Octagon 1, Title Bout:=KOTO Featherweight Championship, Status Before Fight:=Unknown / Possibly Vacant, Billing:=Co-Main Event, Duration:=5 x 3 Minute Rounds, Weight:=Featherweight · 145 lbs (65.8 kg), Referee:=Dave Finch}}, Bout{id='b977976', status='win', sport='mma', division='amateur', boutId='977976', method='SUB', opponentId='408272-kyle-mcneill', boutPageId='977976-bfc-7-kyle-mcneill-vs-ryan-the-ginger-ninja-dobinson', fightShortDescription='Rear Naked Choke · 2:39 · R1', eventPageId='125690-british-fighting-championship-7-bfc-7', eventName='BFC 7', fighterRecordBeforeFight='4-3', opponentRecordBeforeFight='4-1', fightYear='2025', fightDay='Apr 19', details={Event:=BFC 7, Title Bout:=BFC Interim Featherweight Championship, Status Before Fight:=Unknown / Possibly Vacant, Billing:=Main Event, Duration:=5 x 3 Minute Rounds, Weight:=Featherweight · 145 lbs (65.8 kg)}}, Bout{id='b920603', status='cancelled', sport='mma', division='amateur', boutId='920603', method='null', opponentId='120278-jasim-beg', boutPageId='920603-rise-and-conquer-15-jasim-beg-vs-ryan-the-ginger-ninja-dobinson', fightShortDescription='Cancelled Bout', eventPageId='118408-rise-and-conquer-15', eventName='Rise and Conquer 15', fighterRecordBeforeFight='null', opponentRecordBeforeFight='null', fightYear='2024', fightDay='Oct 5', details={Event:=Rise and Conquer 15, Weight:=Bantamweight · 135 lbs (61.2 kg)}}, Bout{id='b891729', status='loss', sport='mma', division='amateur', boutId='891729', method='DEC', opponentId='349673-rizwaan-khan', boutPageId='891729-machine-mma-rizwaan-khan-vs-ryan-the-ginger-ninja-dobinson', fightShortDescription='Decision · Unanimous', eventPageId='115227-machine-mma', eventName='Machine MMA', fighterRecordBeforeFight='4-2', opponentRecordBeforeFight='2-4', fightYear='2024', fightDay='Jun 29', details={Event:=Machine MMA, Title Bout:=MMMA Featherweight Championship, Status Before Fight:=Unknown / Possibly Vacant, Billing:=Main Card, Duration:=3 x 3 Minute Rounds, Weight:=Featherweight · 145 lbs (65.8 kg)}}, Bout{id='b889927', status='cancelled', sport='mma', division='amateur', boutId='889927', method='null', opponentId='71983-rizwan-khan', boutPageId='889927-machine-mma-rizwan-khan-vs-ryan-the-ginger-ninja-dobinson', fightShortDescription='Cancelled Bout', eventPageId='115227-machine-mma', eventName='Machine MMA', fighterRecordBeforeFight='null', opponentRecordBeforeFight='null', fightYear='2024', fightDay='Jun 29', details={Event:=Machine MMA, Weight:=Lightweight · 155 lbs (70.3 kg)}}, Bout{id='b864828', status='win', sport='mma', division='amateur', boutId='864828', method='SUB', opponentId='311944-matthew-day', boutPageId='864828-rise-and-conquer-14-ryan-the-ginger-ninja-dobinson-vs-matthew-day', fightShortDescription='Rear Naked Choke · R2', eventPageId='108921-rise-and-conquer-14', eventName='Rise and Conquer 14', fighterRecordBeforeFight='3-2', opponentRecordBeforeFight='2-2', fightYear='2024', fightDay='Apr 6', details={Event:=Rise and Conquer 14, Billing:=Preliminary Card, Duration:=3 x 3 Minute Rounds, Weight:=Lightweight · 155 lbs (70.3 kg)}}, Bout{id='b733301', status='loss', sport='mma', division='amateur', boutId='733301', method='DEC', opponentId='333481-ede-jakab', boutPageId='733301-bmf-mma-5-ryan-the-ginger-ninja-dobinson-vs-ede-jakab', fightShortDescription='Decision · Unanimous', eventPageId='98355-bmf-mma-5', eventName='BMF MMA 5', fighterRecordBeforeFight='3-1', opponentRecordBeforeFight='4-0', fightYear='2023', fightDay='Apr 15', details={Event:=BMF MMA 5, Billing:=Main Card, Duration:=3 x 3 Minute Rounds, Weight:=Lightweight · 154 lbs (70.0 kg)}}, Bout{id='b691319', status='win', sport='mma', division='amateur', boutId='691319', method='TKO', opponentId='232349-jack-evans', boutPageId='691319-rise-and-conquer-11-ryan-the-ginger-ninja-dobinson-vs-jack-evans', fightShortDescription='KO/TKO · R2', eventPageId='93300-rise-and-conquer-11', eventName='Rise and Conquer 11', fighterRecordBeforeFight='2-1', opponentRecordBeforeFight='1-0', fightYear='2022', fightDay='Oct 1', details={Event:=Rise and Conquer 11, Billing:=Main Card, Duration:=3 x 3 Minute Rounds, Weight:=Lightweight}}, Bout{id='b676448', status='win', sport='mma', division='amateur', boutId='676448', method='TKO', opponentId='318408-mason-shatwell', boutPageId='676448-bmf-mma-3-ryan-dobinson-vs-mason-shatwell', fightShortDescription='KO/TKO · R1', eventPageId='85148-bmf-mma-4', eventName='BMF MMA 3', fighterRecordBeforeFight='1-1', opponentRecordBeforeFight='1-3', fightYear='2022', fightDay='Jul 16', details={Event:=BMF MMA 3, Billing:=Main Card, Duration:=3 x 3 Minute Rounds, Weight:=Lightweight}}, Bout{id='b613647', status='win', sport='mma', division='amateur', boutId='613647', method='TKO', opponentId='315826-rhys-sobey', boutPageId='613647-meltdown-fighting-championships-7-rhys-sobey-vs-ryan-dobinson', fightShortDescription='KO/TKO · 2:49 · R1', eventPageId='81625-meltdown-fighting-championships-7', eventName='Meltdown Fighting Championships 7', fighterRecordBeforeFight='0-1', opponentRecordBeforeFight='0-0', fightYear='2021', fightDay='Nov 13', details={Event:=Meltdown Fighting Championships 7, Billing:=Preliminary Card, Duration:=3 x 3 Minute Rounds, Weight:=Featherweight · 145 lbs (65.8 kg)}}, Bout{id='b611789', status='loss', sport='mma', division='amateur', boutId='611789', method='DEC', opponentId='304691-micah-naisbet', boutPageId='611789-almighty-fighting-championship-20-micah-naisbet-vs-ryan-dobinson', fightShortDescription='Decision · Unanimous', eventPageId='72453-almighty-fighting-championship-28', eventName='Almighty Fighting Championship 20', fighterRecordBeforeFight='0-0', opponentRecordBeforeFight='1-0', fightYear='2021', fightDay='Sep 25', details={Event:=Almighty Fighting Championship 20, Billing:=Preliminary Card, Duration:=3 x 3 Minute Rounds, Weight:=Featherweight · 145 lbs (65.8 kg)}}]";
    String actual = bout.toString();
    assertEquals(expected, actual);
  }
}
